---
name: agentic-orchestration
description: Spawn and coordinate Claude agents for parallel work
model: opus
context: fork
allowed-tools:
  - Read
  - Task
  - mcp__orchestrator__*
skill-inheritance:
  - messaging
---

# Agentic Orchestration Skill

**Status**: Active
**Last Updated**: 2026-02-08

---

## Overview

Spawn and coordinate Claude agents using two complementary systems:

| System | Mechanism | Best For |
|--------|-----------|----------|
| **Native Agents** (preferred) | `Task` tool + `.claude/agents/*.md` | In-session delegation, fast spawn, hooks work |
| **Orchestrator MCP** (advanced) | `mcp__orchestrator__spawn_agent` | Print-mode isolation, DB tracking, cross-session |

**Default**: Use native agents via Task tool. Fall back to orchestrator for process isolation or DB tracking.

---

## Quick Reference: Agent Types

| Agent | Model | Use For | Cost |
|-------|-------|---------|------|
| **coder-haiku** | Haiku | Code writing, refactoring | $0.035 |
| **python-coder-haiku** | Haiku | Python + DB + REPL | $0.045 |
| **lightweight-haiku** | Haiku | Simple file ops | $0.01 |
| **reviewer-sonnet** | Sonnet | Code review (read-only) | $0.105 |
| **security-sonnet** | Sonnet | Security audits (read-only) | $0.24 |
| **analyst-sonnet** | Sonnet | Research, docs | $0.30 |
| **mui-coder-sonnet** | Sonnet | React/MUI UI | $0.12 |
| **tester-haiku** | Haiku | Unit/integration tests | $0.052 |
| **web-tester-haiku** | Haiku | E2E Playwright tests | $0.05 |
| **architect-opus** | Opus | Architecture design | $0.825 |

**Source of truth**: `claude.agent_definitions` table. Files generated by `generate_agent_files.py`.

---

## Native Agents (Preferred)

### Basic Delegation

Use the `Task` tool with `subagent_type` matching any `.claude/agents/*.md` name:

```
Task(
    subagent_type="coder-haiku",
    description="Implement auth middleware",
    prompt="Create JWT auth middleware in src/middleware/auth.ts following existing patterns."
)
```

### Parallel Delegation

Launch multiple agents simultaneously by calling Task multiple times in one message:

```
# These run in parallel when called in the same message:
Task(subagent_type="reviewer-sonnet", prompt="Review src/auth/ changes")
Task(subagent_type="tester-haiku", prompt="Add tests for src/auth/middleware.ts")
Task(subagent_type="security-sonnet", prompt="Scan src/auth/ for vulnerabilities")
```

### Background Agents

Use `run_in_background=true` for long-running tasks:

```
Task(
    subagent_type="analyst-sonnet",
    description="Research OAuth patterns",
    prompt="Research modern OAuth 2.0 patterns...",
    run_in_background=true
)
# Returns output_file path - check later with Read tool
```

### Model Override

Force a different model tier:

```
Task(
    subagent_type="general-purpose",
    model="haiku",  # Override to cheaper model
    prompt="Simple file organization task"
)
```

---

## Orchestrator MCP (Advanced)

Use for: process isolation, DB-tracked sessions, cross-project messaging, print-mode agents.

### Synchronous Spawn

```python
mcp__orchestrator__spawn_agent(
    agent_type="reviewer-sonnet",
    task="Review all staged changes for code quality and security",
    workspace_dir="C:/Projects/myproject"
)
```

### Asynchronous Spawn

```python
mcp__orchestrator__spawn_agent_async(
    agent_type="analyst-sonnet",
    task="Research and document API patterns",
    workspace_dir="C:/Projects/myproject",
    callback_project="claude-family"
)
# Check later:
mcp__orchestrator__check_async_task(task_id=task_id)
```

### When to Use Orchestrator Over Native

| Scenario | Use |
|----------|-----|
| Quick subtask in same session | Native Task |
| Need DB tracking of agent work | Orchestrator |
| Agent needs full MCP access | Orchestrator (print-mode) |
| Cross-project agent work | Orchestrator |
| Resume agent conversation | Native Task (resume param) |
| Parallel independent queries | Native Task (faster spawn) |

---

## Agent Selection Guide

```
Task complexity → Agent choice:
  Simple (1 file, straightforward) → lightweight-haiku ($0.01)
  Standard code (1-3 files)       → coder-haiku ($0.035)
  Python + DB work                → python-coder-haiku ($0.045)
  Complex code (3+ files)         → coder-sonnet ($0.12)
  React/MUI UI work               → mui-coder-sonnet ($0.12)
  WinForms development            → winforms-coder-haiku ($0.045)
  Code review (mandatory)         → reviewer-sonnet ($0.105)
  Security scanning               → security-sonnet ($0.24)
  Tests                           → tester-haiku ($0.052)
  E2E web tests                   → web-tester-haiku ($0.05)
  Research/docs                   → analyst-sonnet ($0.30)
  Architecture decisions          → architect-opus ($0.825)
```

**Cost rule**: Haiku ($0.01-0.05) → Sonnet ($0.10-0.30) → Opus ($0.80+)

---

## Coordinator Patterns

### Pattern 1: Plan + Delegate

```
1. I (Opus) analyze the task and create build tasks
2. Spawn coder-haiku/sonnet per task
3. Spawn reviewer-sonnet before commit
```

### Pattern 2: Research Coordinator

```
Task(subagent_type="analyst-sonnet", prompt="Research topic A")
Task(subagent_type="analyst-sonnet", prompt="Research topic B")
# Both run in parallel, synthesize results myself
```

### Pattern 3: Quality Gate

```
# After writing code:
Task(subagent_type="reviewer-sonnet", prompt="Review changes")
Task(subagent_type="security-sonnet", prompt="Security scan")
Task(subagent_type="tester-haiku", prompt="Add tests")
# Only commit if all pass
```

---

## Monitoring

```sql
-- Agent success rates (orchestrator-spawned only)
SELECT agent_type, COUNT(*) as spawns,
    ROUND(AVG(CASE WHEN success THEN 100 ELSE 0 END), 1) as success_pct
FROM claude.agent_sessions
WHERE completed_at IS NOT NULL
GROUP BY agent_type ORDER BY spawns DESC;
```

---

## Key Gotchas

1. **Wrong agent for task**: Using architect-opus ($0.83) for simple refactoring. Match agent to complexity.
2. **Native agents don't have orchestrator MCP**: They use built-in tools only. Use orchestrator spawn for agents needing inter-agent messaging.
3. **Hooks disabled in orchestrator agents**: Print-mode agents have `disableAllHooks: true`. No RAG, no auto-logging.
4. **Agent definitions are DB-driven**: Edit `claude.agent_definitions` table, run `generate_agent_files.py --all` to deploy.

---

**Version**: 2.0 (Rewritten for dual native+orchestrator approach)
**Created**: 2025-12-26
**Updated**: 2026-02-08
**Location**: .claude/skills/agentic-orchestration/skill.md
