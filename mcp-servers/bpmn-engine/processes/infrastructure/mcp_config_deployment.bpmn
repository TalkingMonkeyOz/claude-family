<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions
    xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL"
    xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
    xmlns:dc="http://www.omg.org/spec/DD/20100524/DC"
    xmlns:di="http://www.omg.org/spec/DD/20100524/DI"
    targetNamespace="http://claude-family/bpmn/mcp-config-deployment"
    id="Definitions_McpConfigDeployment">

  <bpmn:process id="L2_mcp_config_deployment" name="MCP Config Deployment: Two-Tier Configuration" isExecutable="true">

    <!--
      Models the two-tier MCP configuration system used by the Claude Family launcher.

      Tier 1 - Global MCP Config (~/.claude/mcp.json):
        Manually maintained. Contains core infrastructure MCPs available to ALL sessions.
        Not DB-driven. Updated by direct file edit only.

      Tier 2 - Project MCP Config ({project}/.mcp.json):
        DB-driven. Source of truth: claude.workspaces.startup_config.mcp_configs.
        Generated by scripts/generate_mcp_config.py on every project launch.
        Features: npx -> direct node path resolution, Windows cmd /c wrapper.

      Flow A - Launcher (flow_type="launch"):
        start -> route_gw [launch]
          -> select_project [user]
          -> read_workspace_config
          -> has_mcp_configs_gw
               [yes] -> generate_mcp_json -> resolve_npx_paths -> write_mcp_json
               [no]  -> skip_mcp_generation
          -> deploy_other_configs -> launch_claude -> load_mcp_configs -> end_launched

      Flow B - Add/Remove MCP (flow_type="add_remove"):
        start -> route_gw [default/add_remove]
          -> scope_gw
               [global]  -> edit_global_mcp_json [user] -> audit_merge_gw
               [project] -> update_db_mcp_configs -> regenerate_project_mcp -> audit_merge_gw
          -> record_audit -> end_mcp_changed

      Input: flow_type ("launch" | "add_remove")
    -->

    <!-- ================================================================== -->
    <!-- SHARED ENTRY POINT                                                  -->
    <!-- ================================================================== -->

    <bpmn:startEvent id="start" name="MCP Config Deployment Requested">
      <bpmn:outgoing>flow_start_init</bpmn:outgoing>
    </bpmn:startEvent>

    <!-- Initialize defaults so gateway conditions don't error on missing variables -->
    <bpmn:scriptTask id="init_defaults" name="[INIT] Set Default Values" scriptFormat="python">
      <bpmn:incoming>flow_start_init</bpmn:incoming>
      <bpmn:outgoing>flow_init_route</bpmn:outgoing>
      <bpmn:script>
try:
    _ft = flow_type
except NameError:
    _ft = 'add_remove'
flow_type = _ft
try:
    _ms = mcp_scope
except NameError:
    _ms = 'project'
mcp_scope = _ms
      </bpmn:script>
    </bpmn:scriptTask>

    <!-- Top-level gateway: launcher flow vs add/remove flow -->
    <!-- default=flow_add_remove so that any flow_type != "launch" goes to add/remove -->
    <bpmn:exclusiveGateway id="route_gw" name="Flow Type?" default="flow_add_remove">
      <bpmn:incoming>flow_init_route</bpmn:incoming>
      <bpmn:outgoing>flow_launch</bpmn:outgoing>
      <bpmn:outgoing>flow_add_remove</bpmn:outgoing>
    </bpmn:exclusiveGateway>

    <!-- ================================================================== -->
    <!-- FLOW A: LAUNCHER (start-claude.bat)                                -->
    <!-- ================================================================== -->

    <!-- User selects project from DB-driven menu in start-claude.bat -->
    <bpmn:userTask id="select_project" name="[USER] Select Project from List">
      <bpmn:incoming>flow_launch</bpmn:incoming>
      <bpmn:outgoing>flow_select_read</bpmn:outgoing>
    </bpmn:userTask>

    <!-- Read workspace config from DB: startup_config, mcp_configs, project_path -->
    <bpmn:scriptTask id="read_workspace_config" name="[DB] Read Workspace Config" scriptFormat="python">
      <bpmn:incoming>flow_select_read</bpmn:incoming>
      <bpmn:outgoing>flow_read_gw</bpmn:outgoing>
      <bpmn:script>
# SELECT startup_config FROM claude.workspaces WHERE name = project_name
# Extracts: project_path, mcp_configs list, other startup settings
# Input:  project_name, project_path, mcp_configs (set by select_project user task)
# Output: workspace_read_ok
workspace_read_ok = True
try:
    _mcp_configs = mcp_configs
except NameError:
    _mcp_configs = None
mcp_configs = _mcp_configs
try:
    _project_path = project_path
except NameError:
    _project_path = '/projects/default'
project_path = _project_path
      </bpmn:script>
    </bpmn:scriptTask>

    <!-- GATEWAY: Does the project have mcp_configs in its workspace startup_config? -->
    <bpmn:exclusiveGateway id="has_mcp_configs_gw" name="Has mcp_configs in DB?" default="flow_no_mcp_configs">
      <bpmn:incoming>flow_read_gw</bpmn:incoming>
      <bpmn:outgoing>flow_has_mcp_configs</bpmn:outgoing>
      <bpmn:outgoing>flow_no_mcp_configs</bpmn:outgoing>
    </bpmn:exclusiveGateway>

    <!-- ================================================================== -->
    <!-- FLOW A BRANCH YES: Generate .mcp.json                              -->
    <!-- ================================================================== -->

    <!-- Read mcp_configs JSONB entries from workspaces.startup_config -->
    <bpmn:scriptTask id="generate_mcp_json" name="[TOOL] Read mcp_configs from DB" scriptFormat="python">
      <bpmn:incoming>flow_has_mcp_configs</bpmn:incoming>
      <bpmn:outgoing>flow_gen_resolve</bpmn:outgoing>
      <bpmn:script>
# Parse mcp_configs list from startup_config JSONB
# Each entry: {name, command, args, env}
# Output: raw_mcp_entries (list of server configs)
raw_mcp_entries = mcp_configs if mcp_configs else []
mcp_entries_read = True
      </bpmn:script>
    </bpmn:scriptTask>

    <!-- Resolve npx commands to direct node.exe paths for Windows reliability -->
    <bpmn:scriptTask id="resolve_npx_paths" name="[TOOL] Resolve npx to node Paths" scriptFormat="python">
      <bpmn:incoming>flow_gen_resolve</bpmn:incoming>
      <bpmn:outgoing>flow_resolve_write</bpmn:outgoing>
      <bpmn:script>
# Convert: "npx -y @package/server" -> cmd /c node ... for Windows compatibility
# Input: raw_mcp_entries
# Output: resolved_mcp_entries, paths_resolved
resolved_mcp_entries = []
for entry in raw_mcp_entries:
    cmd = entry.get('command', '')
    resolved = dict(entry)
    if cmd == 'npx':
        resolved['command'] = 'cmd'
        resolved['args'] = ['/c', 'node'] + entry.get('args', [])[2:]
        resolved['_resolved'] = True
    resolved_mcp_entries.append(resolved)
paths_resolved = True
      </bpmn:script>
    </bpmn:scriptTask>

    <!-- Write resolved config to {project}/.mcp.json -->
    <bpmn:scriptTask id="write_mcp_json" name="[FILE] Write .mcp.json" scriptFormat="python">
      <bpmn:incoming>flow_resolve_write</bpmn:incoming>
      <bpmn:outgoing>flow_write_merge</bpmn:outgoing>
      <bpmn:script>
# Write JSON to {project_path}/.mcp.json
# Format: {"mcpServers": {server_name: {command, args, env}}}
mcp_json_written = True
mcp_json_path = project_path + '/.mcp.json'
server_count = len(resolved_mcp_entries)
      </bpmn:script>
    </bpmn:scriptTask>

    <!-- ================================================================== -->
    <!-- FLOW A BRANCH NO: Skip .mcp.json generation                        -->
    <!-- ================================================================== -->

    <!-- Project uses only global ~/.claude/mcp.json (Tier 1) -->
    <bpmn:scriptTask id="skip_mcp_generation" name="[TOOL] Skip .mcp.json (No Config)" scriptFormat="python">
      <bpmn:incoming>flow_no_mcp_configs</bpmn:incoming>
      <bpmn:outgoing>flow_skip_merge</bpmn:outgoing>
      <bpmn:script>
# No project-level .mcp.json needed - global MCPs are sufficient
mcp_json_written = False
mcp_generation_skipped = True
server_count = 0
      </bpmn:script>
    </bpmn:scriptTask>

    <!-- ================================================================== -->
    <!-- FLOW A MERGE: Continue with deployment + launch                     -->
    <!-- ================================================================== -->

    <!-- Merge: both yes/no branches converge here -->
    <bpmn:exclusiveGateway id="mcp_merge_gw" name="MCP Step Done">
      <bpmn:incoming>flow_write_merge</bpmn:incoming>
      <bpmn:incoming>flow_skip_merge</bpmn:incoming>
      <bpmn:outgoing>flow_merge_deploy</bpmn:outgoing>
    </bpmn:exclusiveGateway>

    <!-- Deploy other project configs: settings.local.json, CLAUDE.md, rules, skills -->
    <bpmn:scriptTask id="deploy_other_configs" name="[TOOL] Deploy Other Configs" scriptFormat="python">
      <bpmn:incoming>flow_merge_deploy</bpmn:incoming>
      <bpmn:outgoing>flow_deploy_launch</bpmn:outgoing>
      <bpmn:script>
# Runs: generate_project_settings.py -> settings.local.json (self-healing from DB)
# Runs: deploy_components.py -> CLAUDE.md, rules, skills, instructions
other_configs_deployed = True
settings_deployed = True
claude_md_deployed = True
      </bpmn:script>
    </bpmn:scriptTask>

    <!-- Launch Claude Code in the project directory -->
    <bpmn:scriptTask id="launch_claude" name="[TOOL] Launch Claude Code" scriptFormat="python">
      <bpmn:incoming>flow_deploy_launch</bpmn:incoming>
      <bpmn:outgoing>flow_launch_load</bpmn:outgoing>
      <bpmn:script>
# Executes: claude --project {project_path}
# Claude Code will load both config tiers on startup
claude_launched = True
launch_path = project_path
      </bpmn:script>
    </bpmn:scriptTask>

    <!-- Claude Code merges Tier 1 + Tier 2 MCP configs on startup -->
    <bpmn:scriptTask id="load_mcp_configs" name="[CLAUDE] Load Global + Project MCPs" scriptFormat="python">
      <bpmn:incoming>flow_launch_load</bpmn:incoming>
      <bpmn:outgoing>flow_load_end</bpmn:outgoing>
      <bpmn:script>
# Claude Code auto-merges:
#   ~/.claude/mcp.json        (Tier 1: orchestrator, postgres, sequential-thinking, project-tools)
#   {project}/.mcp.json       (Tier 2: project-specific MCPs, if generated)
# Result: merged registry with all available servers for this session
global_mcps_loaded = True
project_mcps_loaded = mcp_json_written
merged_mcp_registry = ['global_mcps'] + (['project_mcps'] if project_mcps_loaded else [])
      </bpmn:script>
    </bpmn:scriptTask>

    <!-- END A: Launcher flow complete, Claude is running -->
    <bpmn:endEvent id="end_launched" name="Claude Running with MCP Config">
      <bpmn:incoming>flow_load_end</bpmn:incoming>
    </bpmn:endEvent>

    <!-- ================================================================== -->
    <!-- FLOW B: ADD/REMOVE MCP SERVER                                      -->
    <!-- ================================================================== -->

    <!-- GATEWAY: Is this a global (Tier 1) or project-specific (Tier 2) MCP? -->
    <!-- default=flow_project_scope so that any mcp_scope != "global" -> project -->
    <bpmn:exclusiveGateway id="scope_gw" name="Global or Project MCP?" default="flow_project_scope">
      <bpmn:incoming>flow_add_remove</bpmn:incoming>
      <bpmn:outgoing>flow_global_scope</bpmn:outgoing>
      <bpmn:outgoing>flow_project_scope</bpmn:outgoing>
    </bpmn:exclusiveGateway>

    <!-- ================================================================== -->
    <!-- FLOW B BRANCH GLOBAL: Manual file edit                             -->
    <!-- ================================================================== -->

    <!-- Manual intervention required: Claude cannot auto-update ~/.claude/mcp.json -->
    <bpmn:userTask id="edit_global_mcp_json" name="[USER] Edit ~/.claude/mcp.json Manually">
      <bpmn:incoming>flow_global_scope</bpmn:incoming>
      <bpmn:outgoing>flow_global_audit</bpmn:outgoing>
    </bpmn:userTask>

    <!-- ================================================================== -->
    <!-- FLOW B BRANCH PROJECT: DB update + regenerate                      -->
    <!-- ================================================================== -->

    <!-- Update mcp_configs JSONB in the workspaces table -->
    <bpmn:scriptTask id="update_db_mcp_configs" name="[DB] Update workspaces.startup_config.mcp_configs" scriptFormat="python">
      <bpmn:incoming>flow_project_scope</bpmn:incoming>
      <bpmn:outgoing>flow_db_regenerate</bpmn:outgoing>
      <bpmn:script>
# UPDATE claude.workspaces
#   SET startup_config = jsonb_set(startup_config, '{mcp_configs}', new_mcp_configs_json)
# WHERE name = project_name
# Input: project_name, mcp_server_name, mcp_action ('add'|'remove'), mcp_server_config
db_mcp_configs_updated = True
      </bpmn:script>
    </bpmn:scriptTask>

    <!-- Regenerate .mcp.json from the updated DB record -->
    <bpmn:scriptTask id="regenerate_project_mcp" name="[TOOL] Regenerate .mcp.json" scriptFormat="python">
      <bpmn:incoming>flow_db_regenerate</bpmn:incoming>
      <bpmn:outgoing>flow_project_audit</bpmn:outgoing>
      <bpmn:script>
# Runs generate_mcp_config.py for the project
# Re-reads mcp_configs from DB and re-writes .mcp.json
# Same resolve_npx_paths logic as launcher flow applies here too
mcp_json_regenerated = True
      </bpmn:script>
    </bpmn:scriptTask>

    <!-- ================================================================== -->
    <!-- FLOW B MERGE: Audit log entry                                      -->
    <!-- ================================================================== -->

    <!-- Merge: global and project paths both reach audit -->
    <bpmn:exclusiveGateway id="audit_merge_gw" name="Audit Merge">
      <bpmn:incoming>flow_global_audit</bpmn:incoming>
      <bpmn:incoming>flow_project_audit</bpmn:incoming>
      <bpmn:outgoing>flow_audit_record</bpmn:outgoing>
    </bpmn:exclusiveGateway>

    <!-- Record the change in the mcp_configs audit table -->
    <bpmn:scriptTask id="record_audit" name="[DB] Record in mcp_configs Audit" scriptFormat="python">
      <bpmn:incoming>flow_audit_record</bpmn:incoming>
      <bpmn:outgoing>flow_audit_end</bpmn:outgoing>
      <bpmn:script>
# INSERT INTO claude.mcp_configs_audit (project_name, server_name, action, changed_at, tier)
# Input: mcp_server_name, mcp_action, project_name (or 'global'), mcp_scope
try:
    _scope = mcp_scope
except NameError:
    _scope = 'project'
tier = 'global' if _scope == 'global' else 'project'
audit_recorded = True
      </bpmn:script>
    </bpmn:scriptTask>

    <!-- END B: MCP change committed -->
    <bpmn:endEvent id="end_mcp_changed" name="MCP Config Updated">
      <bpmn:incoming>flow_audit_end</bpmn:incoming>
    </bpmn:endEvent>

    <!-- ================================================================== -->
    <!-- SEQUENCE FLOWS - SHARED ENTRY                                      -->
    <!-- ================================================================== -->

    <bpmn:sequenceFlow id="flow_start_init" sourceRef="start" targetRef="init_defaults"/>
    <bpmn:sequenceFlow id="flow_init_route" sourceRef="init_defaults" targetRef="route_gw"/>

    <bpmn:sequenceFlow id="flow_launch" sourceRef="route_gw" targetRef="select_project">
      <bpmn:conditionExpression>flow_type == "launch"</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <!-- flow_add_remove is the default (no conditionExpression) -->
    <bpmn:sequenceFlow id="flow_add_remove" sourceRef="route_gw" targetRef="scope_gw"/>

    <!-- ================================================================== -->
    <!-- SEQUENCE FLOWS - FLOW A (LAUNCHER)                                 -->
    <!-- ================================================================== -->

    <bpmn:sequenceFlow id="flow_select_read" sourceRef="select_project" targetRef="read_workspace_config"/>
    <bpmn:sequenceFlow id="flow_read_gw" sourceRef="read_workspace_config" targetRef="has_mcp_configs_gw"/>

    <bpmn:sequenceFlow id="flow_has_mcp_configs" sourceRef="has_mcp_configs_gw" targetRef="generate_mcp_json">
      <bpmn:conditionExpression>mcp_configs is not None and len(mcp_configs) &gt; 0</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <!-- flow_no_mcp_configs is the default -->
    <bpmn:sequenceFlow id="flow_no_mcp_configs" sourceRef="has_mcp_configs_gw" targetRef="skip_mcp_generation"/>

    <bpmn:sequenceFlow id="flow_gen_resolve" sourceRef="generate_mcp_json" targetRef="resolve_npx_paths"/>
    <bpmn:sequenceFlow id="flow_resolve_write" sourceRef="resolve_npx_paths" targetRef="write_mcp_json"/>
    <bpmn:sequenceFlow id="flow_write_merge" sourceRef="write_mcp_json" targetRef="mcp_merge_gw"/>
    <bpmn:sequenceFlow id="flow_skip_merge" sourceRef="skip_mcp_generation" targetRef="mcp_merge_gw"/>

    <bpmn:sequenceFlow id="flow_merge_deploy" sourceRef="mcp_merge_gw" targetRef="deploy_other_configs"/>
    <bpmn:sequenceFlow id="flow_deploy_launch" sourceRef="deploy_other_configs" targetRef="launch_claude"/>
    <bpmn:sequenceFlow id="flow_launch_load" sourceRef="launch_claude" targetRef="load_mcp_configs"/>
    <bpmn:sequenceFlow id="flow_load_end" sourceRef="load_mcp_configs" targetRef="end_launched"/>

    <!-- ================================================================== -->
    <!-- SEQUENCE FLOWS - FLOW B (ADD/REMOVE MCP)                           -->
    <!-- ================================================================== -->

    <bpmn:sequenceFlow id="flow_global_scope" sourceRef="scope_gw" targetRef="edit_global_mcp_json">
      <bpmn:conditionExpression>mcp_scope == "global"</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <!-- flow_project_scope is the default -->
    <bpmn:sequenceFlow id="flow_project_scope" sourceRef="scope_gw" targetRef="update_db_mcp_configs"/>

    <bpmn:sequenceFlow id="flow_global_audit" sourceRef="edit_global_mcp_json" targetRef="audit_merge_gw"/>
    <bpmn:sequenceFlow id="flow_db_regenerate" sourceRef="update_db_mcp_configs" targetRef="regenerate_project_mcp"/>
    <bpmn:sequenceFlow id="flow_project_audit" sourceRef="regenerate_project_mcp" targetRef="audit_merge_gw"/>

    <bpmn:sequenceFlow id="flow_audit_record" sourceRef="audit_merge_gw" targetRef="record_audit"/>
    <bpmn:sequenceFlow id="flow_audit_end" sourceRef="record_audit" targetRef="end_mcp_changed"/>

  </bpmn:process>

  <!-- ================================================================== -->
  <!-- DIAGRAM LAYOUT                                                      -->
  <!-- ================================================================== -->

  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="L2_mcp_config_deployment">

      <!-- SHARED ENTRY -->

      <bpmndi:BPMNShape id="s_start" bpmnElement="start">
        <dc:Bounds x="50" y="270" width="36" height="36"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="s_init_defaults" bpmnElement="init_defaults">
        <dc:Bounds x="100" y="250" width="120" height="60"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="s_route_gw" bpmnElement="route_gw" isMarkerVisible="true">
        <dc:Bounds x="270" y="263" width="50" height="50"/>
      </bpmndi:BPMNShape>

      <!-- FLOW A: LAUNCHER (top lane, y=80..220) -->

      <bpmndi:BPMNShape id="s_select_project" bpmnElement="select_project">
        <dc:Bounds x="250" y="80" width="140" height="80"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="s_read_workspace" bpmnElement="read_workspace_config">
        <dc:Bounds x="450" y="80" width="140" height="80"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="s_has_mcp_gw" bpmnElement="has_mcp_configs_gw" isMarkerVisible="true">
        <dc:Bounds x="650" y="93" width="50" height="50"/>
      </bpmndi:BPMNShape>

      <!-- Branch YES: generate .mcp.json (upper sub-lane) -->
      <bpmndi:BPMNShape id="s_generate_mcp" bpmnElement="generate_mcp_json">
        <dc:Bounds x="760" y="40" width="160" height="80"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="s_resolve_npx" bpmnElement="resolve_npx_paths">
        <dc:Bounds x="980" y="40" width="160" height="80"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="s_write_mcp" bpmnElement="write_mcp_json">
        <dc:Bounds x="1200" y="40" width="140" height="80"/>
      </bpmndi:BPMNShape>

      <!-- Branch NO: skip (lower sub-lane) -->
      <bpmndi:BPMNShape id="s_skip_mcp" bpmnElement="skip_mcp_generation">
        <dc:Bounds x="760" y="160" width="160" height="80"/>
      </bpmndi:BPMNShape>

      <!-- Merge -->
      <bpmndi:BPMNShape id="s_mcp_merge" bpmnElement="mcp_merge_gw" isMarkerVisible="true">
        <dc:Bounds x="1400" y="93" width="50" height="50"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="s_deploy_other" bpmnElement="deploy_other_configs">
        <dc:Bounds x="1510" y="80" width="140" height="80"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="s_launch_claude" bpmnElement="launch_claude">
        <dc:Bounds x="1710" y="80" width="140" height="80"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="s_load_mcp" bpmnElement="load_mcp_configs">
        <dc:Bounds x="1910" y="80" width="160" height="80"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="s_end_launched" bpmnElement="end_launched">
        <dc:Bounds x="2130" y="100" width="36" height="36"/>
      </bpmndi:BPMNShape>

      <!-- FLOW B: ADD/REMOVE MCP (bottom lane, y=380..560) -->

      <bpmndi:BPMNShape id="s_scope_gw" bpmnElement="scope_gw" isMarkerVisible="true">
        <dc:Bounds x="250" y="453" width="50" height="50"/>
      </bpmndi:BPMNShape>

      <!-- Global branch (upper sub-lane) -->
      <bpmndi:BPMNShape id="s_edit_global" bpmnElement="edit_global_mcp_json">
        <dc:Bounds x="370" y="390" width="180" height="80"/>
      </bpmndi:BPMNShape>

      <!-- Project branch (lower sub-lane) -->
      <bpmndi:BPMNShape id="s_update_db" bpmnElement="update_db_mcp_configs">
        <dc:Bounds x="370" y="530" width="200" height="80"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="s_regenerate" bpmnElement="regenerate_project_mcp">
        <dc:Bounds x="630" y="530" width="160" height="80"/>
      </bpmndi:BPMNShape>

      <!-- Audit merge -->
      <bpmndi:BPMNShape id="s_audit_merge" bpmnElement="audit_merge_gw" isMarkerVisible="true">
        <dc:Bounds x="850" y="453" width="50" height="50"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="s_record_audit" bpmnElement="record_audit">
        <dc:Bounds x="960" y="440" width="160" height="80"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="s_end_mcp_changed" bpmnElement="end_mcp_changed">
        <dc:Bounds x="1180" y="460" width="36" height="36"/>
      </bpmndi:BPMNShape>

      <!-- EDGES: SHARED ENTRY -->

      <bpmndi:BPMNEdge id="e_start_init" bpmnElement="flow_start_init">
        <di:waypoint x="86" y="288"/>
        <di:waypoint x="100" y="280"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="e_init_route" bpmnElement="flow_init_route">
        <di:waypoint x="220" y="280"/>
        <di:waypoint x="270" y="288"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="e_launch" bpmnElement="flow_launch">
        <di:waypoint x="295" y="263"/>
        <di:waypoint x="295" y="120"/>
        <di:waypoint x="380" y="120"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="e_add_remove" bpmnElement="flow_add_remove">
        <di:waypoint x="295" y="313"/>
        <di:waypoint x="295" y="478"/>
        <di:waypoint x="380" y="478"/>
      </bpmndi:BPMNEdge>

      <!-- EDGES: FLOW A -->

      <bpmndi:BPMNEdge id="e_select_read" bpmnElement="flow_select_read">
        <di:waypoint x="390" y="120"/>
        <di:waypoint x="450" y="120"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="e_read_gw" bpmnElement="flow_read_gw">
        <di:waypoint x="590" y="120"/>
        <di:waypoint x="650" y="118"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="e_has_mcp" bpmnElement="flow_has_mcp_configs">
        <di:waypoint x="675" y="93"/>
        <di:waypoint x="675" y="80"/>
        <di:waypoint x="760" y="80"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="e_no_mcp" bpmnElement="flow_no_mcp_configs">
        <di:waypoint x="675" y="143"/>
        <di:waypoint x="675" y="200"/>
        <di:waypoint x="760" y="200"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="e_gen_resolve" bpmnElement="flow_gen_resolve">
        <di:waypoint x="920" y="80"/>
        <di:waypoint x="980" y="80"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="e_resolve_write" bpmnElement="flow_resolve_write">
        <di:waypoint x="1140" y="80"/>
        <di:waypoint x="1200" y="80"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="e_write_merge" bpmnElement="flow_write_merge">
        <di:waypoint x="1340" y="80"/>
        <di:waypoint x="1425" y="80"/>
        <di:waypoint x="1425" y="93"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="e_skip_merge" bpmnElement="flow_skip_merge">
        <di:waypoint x="920" y="200"/>
        <di:waypoint x="1425" y="200"/>
        <di:waypoint x="1425" y="143"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="e_merge_deploy" bpmnElement="flow_merge_deploy">
        <di:waypoint x="1450" y="118"/>
        <di:waypoint x="1510" y="120"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="e_deploy_launch" bpmnElement="flow_deploy_launch">
        <di:waypoint x="1650" y="120"/>
        <di:waypoint x="1710" y="120"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="e_launch_load" bpmnElement="flow_launch_load">
        <di:waypoint x="1850" y="120"/>
        <di:waypoint x="1910" y="120"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="e_load_end" bpmnElement="flow_load_end">
        <di:waypoint x="2070" y="120"/>
        <di:waypoint x="2130" y="118"/>
      </bpmndi:BPMNEdge>

      <!-- EDGES: FLOW B -->

      <bpmndi:BPMNEdge id="e_global_scope" bpmnElement="flow_global_scope">
        <di:waypoint x="275" y="453"/>
        <di:waypoint x="275" y="430"/>
        <di:waypoint x="370" y="430"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="e_project_scope" bpmnElement="flow_project_scope">
        <di:waypoint x="275" y="503"/>
        <di:waypoint x="275" y="570"/>
        <di:waypoint x="370" y="570"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="e_global_audit" bpmnElement="flow_global_audit">
        <di:waypoint x="550" y="430"/>
        <di:waypoint x="875" y="430"/>
        <di:waypoint x="875" y="453"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="e_db_regenerate" bpmnElement="flow_db_regenerate">
        <di:waypoint x="570" y="570"/>
        <di:waypoint x="630" y="570"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="e_project_audit" bpmnElement="flow_project_audit">
        <di:waypoint x="790" y="570"/>
        <di:waypoint x="875" y="570"/>
        <di:waypoint x="875" y="503"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="e_audit_record" bpmnElement="flow_audit_record">
        <di:waypoint x="900" y="478"/>
        <di:waypoint x="960" y="480"/>
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="e_audit_end" bpmnElement="flow_audit_end">
        <di:waypoint x="1120" y="480"/>
        <di:waypoint x="1180" y="478"/>
      </bpmndi:BPMNEdge>

    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>

</bpmn:definitions>
